/* -----------------------------------------------------------------------------
 * MEDIAQUERIES
 */

@use 'sass:list';
@use 'sass:map';
@use 'sass:meta';
// Access variables and helpers directly from settings modules
@use "../settings/settings.config" as *;
@use "../settings/functions/px-to-em" as *;

// Functions
// -----------------------------------------------------------------------------

// Get next breakpoint in map

@function map-next-value($_map, $_input) {
  $_values: list-sort(map-values($_map));

  @each $_value in $_values {
     @if px-to-em($_value) > px-to-em($_input){
      @return $_value;
    }
  }

  @error 'Next value is not defined.';
}

// Type of breakpoint

@function breakpoint-type($_value) {
  @if meta.type-of($_value) == number{
    @return px-to-em($_value);
  }

  @else if map.has-key($s-mq-breakpoints, $_value) {
     @return px-to-em(map.get($s-mq-breakpoints, $_value));
  }

  @else if $_value == 'up' or $_value == 'down' or $_value == 'only' {
    @return $_value;
  }

  @else {
     @error "Breakpoint `#{$_value}` doesn't exists. Create a new one, choose one of these: #{map.keys($s-mq-breakpoints)} or write a value in pixels.";
  }
}

// Set breakpoint

@function breakpoint($_value, $_orientation:'') {
  @if $_value == 'retina' {
    @return '(-webkit-min-device-pixel-ratio: 2), screen and (min-resolution: 192dpi)';
  }

  @else if $_value == 'landscape' or $_value == 'portrait' {
    @return '(orientation: #{$_value})';
  }

  $_breakpoint: breakpoint-type(list.nth($_value, 1));
  $_breakpoint-direction: if(list.length($_value) > 1, breakpoint-type(list.nth($_value, 2)), 'up');
  $_result: '';

  @if $_breakpoint-direction == 'up' {
    $_result: $_result + '(min-width: #{$_breakpoint})';
  }

  @else if $_breakpoint-direction == 'down' {
    $_result: $_result + '(max-width: #{$_breakpoint - px-to-em(1px)})';
  }

  @else if $_breakpoint-direction == 'only' {
    $_breakpoint-next: px-to-em(map-next-value($s-mq-breakpoints, $_breakpoint));
    $_result: $_result + '(min-width: #{$_breakpoint}) and (max-width: #{$_breakpoint-next - px-to-em(1px)})';
  }

  @else if meta.type-of($_breakpoint-direction) == number and $_breakpoint < $_breakpoint-direction {
    $_result: $_result + '(min-width: #{$_breakpoint}) and (max-width: #{$_breakpoint-direction - px-to-em(1px)})';
  }
  @else {
    @error "Breakpoint can't be the same or smaller. Correct example: (small medium) or (544px 768px)";
  }
  @if $_orientation == 'landscape' or $_orientation == 'portrait' {
    $_result: $_result +  ' and (orientation: #{$_orientation})';
  }
  @return $_result;
}


// Mixin
// -----------------------------------------------------------------------------

@mixin breakpoint($_value, $_orientation:'', $_media-type: null) {
  // Resolve media type here to avoid module-load-time lookup issues
  $_computed-media-type: if($_media-type == null, $s-mq-media-type, $_media-type);
  $_result: breakpoint($_value, $_orientation);
  @media #{$_computed-media-type} and #{$_result} {
     @content;
  }
}
